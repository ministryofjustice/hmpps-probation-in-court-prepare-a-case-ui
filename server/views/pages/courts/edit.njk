{%- set isOnboarding = state !== "edit" -%}
{%- set hideCourtLink = isOnboarding -%}
{% extends "partials/layout.njk" %}

{% block navigation %}{% endblock %}

{% set title = "Which courts do you work in?" if isOnboarding else "Edit my courts" %}

{%- set courtOptions = [] -%}
{%- for court in availableCourts -%}
  {{ courtOptions.push({
    value: court.code,
    text: court.name
  }) }}
{%- endfor -%}

{% block content %}
  <form method="post" name="selectCourt" action="/my-courts/add" novalidate>
    <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
    <input type="hidden" name="state" value="{{state}}">

    {% if serverError | length %}
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
          {%- from "moj/components/banner/macro.njk" import mojBanner -%}
          {{ mojBanner({
            type: 'warning',
            text: serverError,
            iconFallbackText: 'Warning'
          }) }}
        </div>
      </div>
    {% endif %}

    {% if formError | length %}
      {% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
      {{ govukErrorSummary({
        titleText: "There is a problem",
        errorList: [
          {
            text: "You must add a court",
            href: "#pac-select-court"
          }
        ]
      }) }}
    {% endif %}

    <h1 class="govuk-heading-l">{{ title }}</h1>
    {% if isOnboarding %}
      <p class="govuk-body">Add and save the courts you work in to view case lists for those courts.</p>
    {% else %}
      <p class="govuk-body">Add or remove courts from your list.</p>
    {% endif %}

    {% if chosenCourts | length %}
      <dl class="govuk-summary-list pac-!-grid-column--max-700" aria-label="{{ title }}">
        {%- for court in availableCourts -%}
          {%- for chosen in chosenCourts -%}
            {% if chosen === court.code %}
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">{{ court.name }}</dt>
                <dd class="govuk-summary-list__actions">
                  <a href="/my-courts/remove/{{ court.code | urlencode }}?state={{ state }}"
                     class="govuk-link govuk-link--no-visited-state">Remove<span
                      class="govuk-visually-hidden"> {{ court.name }}</span></a>
                </dd>
              </div>
            {% endif %}
          {%- endfor -%}
        {%- endfor -%}
      </dl>

    {% endif %}

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds pac-!-grid-column--max-700">

        {%- from "../../components/accessible-autocomplete/macro.njk" import pacAccessibleAutocomplete -%}
        {{ pacAccessibleAutocomplete({
          id: 'pac-select-court',
          name: 'court',
          label: 'Add court',
          hint: 'Type in the name of the court',
          instruction: 'Select a court',
          options: courtOptions,
          error: formError | length,
          errorMessage: 'You must add a court',
          nonce: cspNonce
        }) }}

        <button type="submit" class="govuk-button action-button govuk-button--secondary govuk-!-margin-top-4 govuk-!-margin-bottom-0">
          Add
        </button>

        <hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible"/>
      </div>
    </div>

  </form>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-three-quarters">
        <div class="govuk-button-group">
          <form method="post" action="/my-courts" novalidate>
            <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
            <input type="hidden" name="state" value="{{state}}">
            <button type="submit" class="govuk-button">Save {{ "list" if not isOnboarding }} and continue</button>
          </form>
          {% if not isOnboarding %}
            <a href="/my-courts" class="govuk-link govuk-link--no-visited-state">Cancel</a>
          {% endif %}
        </div>
      </div>
    </div>

{% endblock %}
